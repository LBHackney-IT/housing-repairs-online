"use strict";(self.webpackChunkhousing_repairs_online=self.webpackChunkhousing_repairs_online||[]).push([[479],{9251:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>l});var i=r(4848),s=r(8453);const t={},o="Repairs API",d={id:"repairs-api/intro",title:"Repairs API",description:"GitHub Repository",source:"@site/docs/repairs-api/intro.md",sourceDirName:"repairs-api",slug:"/repairs-api/intro",permalink:"/housing-repairs-online/repairs-api/intro",draft:!1,unlisted:!1,editUrl:"https://github.com/LBHackney-IT/housing-repairs-online/tree/main/docs/repairs-api/intro.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Look and feel",permalink:"/housing-repairs-online/front-end/look-and-feel"},next:{title:"Endpoints",permalink:"/housing-repairs-online/category/endpoints"}},a={},l=[{value:"Frameworks used",id:"frameworks-used",level:2},{value:"Blog Storage",id:"blog-storage",level:3},{value:"Cosmos DB",id:"cosmos-db",level:3},{value:"Gov Notify",id:"gov-notify",level:3},{value:"User notifications",id:"user-notifications",level:4},{value:"Internal notification email",id:"internal-notification-email",level:4},{value:"Environment variables",id:"environment-variables",level:2},{value:"Health Checks",id:"health-checks",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components},{Details:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"repairs-api",children:"Repairs API"})}),"\n",(0,i.jsx)("a",{class:"badge badge--secondary",href:"https://github.com/LBHackney-IT/housing-repairs-online-api",children:"GitHub Repository"}),"\n",(0,i.jsx)(n.h2,{id:"frameworks-used",children:"Frameworks used"}),"\n",(0,i.jsx)(n.p,{children:"Written in .Net"}),"\n",(0,i.jsx)(n.h3,{id:"blog-storage",children:"Blog Storage"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-gb/azure/storage/blobs/storage-blobs-introduction",children:"Azure Blob storage"})," is Microsoft's object storage solution for the cloud."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Photos uploaded as part of the ",(0,i.jsxs)(n.a,{href:"../repairs-api/endpoints/repair#body",children:[(0,i.jsx)(n.code,{children:"description.base64img"})," in save repair request body"]})," are uploaded to a container that can be configured via ",(0,i.jsx)(n.a,{href:"#environment-variables",children:"environment variables"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"cosmos-db",children:"Cosmos DB"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://docs.microsoft.com/en-us/azure/cosmos-db/introduction",children:"Azure Cosmos DB"})," is a fully managed NoSQL database service for modern app development."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Submitted repair requests are saved in a container that is configured via ",(0,i.jsx)(n.a,{href:"#environment-variables",children:"environment variables"})," and requests are saved in the following structure:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "id": "20B2459F",\n    "Postcode": "M3 0W",\n    "SOR": "N373049",\n    "Address": {\n        "Display": "123 Cute Street, LN1 3AT",\n        "LocationId": "53660030    "\n    },\n    "Location": {\n        "Value": "kitchen",\n        "Display": "Kitchen"\n    },\n    "Problem": {\n        "Value": "cupboards",\n        "Display": "Cupboards, including damaged cupboard doors"\n    },\n    "Issue": {\n        "Value": "doorHangingOff",\n        "Display": "Hanging door"\n    },\n    "ContactPersonNumber": "01234567890",\n    "Description": {\n        "PhotoUrl": "https://housingrepairsonline.blob.core.windows.net/housing-repairs-online/eb5adfb6-ed53-4f3b-90c4-7a54cc36c56a.png",\n        "Text": "Excepturi quod aute "\n    },\n    "ContactDetails": {\n        "Type": "email",\n        "Value": "luna@email.com"\n    },\n    "Time": {\n        "Value": "27th January 2022 12:00pm to 4:00pm",\n        "Display": "27th January 2022 between 12:00pm to 4:00pm"\n    },\n    "_rid": "rKg5ANy0vjoVAAAAAAAAAA==",\n    "_self": "dbs/rKg5AA==/colls/rKg5ANy0vjo=/docs/rKg5ANy0vjoVAAAAAAAAAA==/",\n    "_etag": "\\"0f00dbde-0000-1100-0000-61e5367b0000\\"",\n    "_attachments": "attachments/",\n    "_ts": 1642411643\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"gov-notify",children:"Gov Notify"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"https://docs.notifications.service.gov.uk/net.html#net-client-documentation",children:"GOV.UK Notify"})," lets you send emails, text messages and letters to your users."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Once a repair request is saved into Cosmos DB, two notifications are sent - one\nto the user and one to the email that's configured via ",(0,i.jsx)(n.a,{href:"#environment-variables",children:"environment variables"})]}),"\n",(0,i.jsx)(n.h4,{id:"user-notifications",children:"User notifications"}),"\n",(0,i.jsxs)(n.p,{children:["Email notification template ID is configured via ",(0,i.jsx)(n.a,{href:"#environment-variables",children:"environment variables"}),"."]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Suggested email template"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)("strong",{children:"From:"}),"\tHousing Repairs Online ",(0,i.jsx)("br",{}),"\n",(0,i.jsx)("strong",{children:"To:"}),"\t((",(0,i.jsx)("code",{children:"email"})," from ",(0,i.jsx)("a",{href:"../repairs-api/endpoints/repair#body",children:(0,i.jsx)("code",{children:"contactDetails.value"})}),")) ",(0,i.jsx)("br",{}),"\n",(0,i.jsx)("strong",{children:"Subject:"}),"\tRepair details ((",(0,i.jsx)("code",{children:"repair_ref"})," generated when saving into Cosmos DB)) ",(0,i.jsx)("br",{})]}),(0,i.jsx)("hr",{}),(0,i.jsx)("p",{children:(0,i.jsx)(n.p,{children:"Your repair has been successfully booked."})}),(0,i.jsx)("p",{children:(0,i.jsxs)(n.p,{children:["Your booking details are: ",(0,i.jsx)("br",{}),"\nBooking reference: ((",(0,i.jsx)("code",{children:"repair_ref"}),"))",(0,i.jsx)("br",{}),"\nAppointment: ((",(0,i.jsx)("code",{children:"appointment_time"})," from ",(0,i.jsx)("a",{href:"../repairs-api/endpoints/repair#body",children:(0,i.jsx)("code",{children:"time.display"})}),"))"]})}),(0,i.jsx)("p",{children:(0,i.jsx)(n.p,{children:"You will receive a reminder the day before your appointment"})})]})]}),"\n",(0,i.jsxs)(n.p,{children:["SMS notification template ID is configured via ",(0,i.jsx)(n.a,{href:"#environment-variables",children:"environment variables"}),"."]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Suggested SMS template"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)("strong",{children:"To:"}),"\t((phone numer from ",(0,i.jsx)("a",{href:"../repairs-api/endpoints/repair#body",children:(0,i.jsx)("code",{children:"contactDetails.value"})}),")) ",(0,i.jsx)("br",{})]}),(0,i.jsx)("hr",{}),(0,i.jsxs)("p",{children:[(0,i.jsxs)(n.p,{children:["Housing Repairs Online: Your repair has been successfully booked. Your\nbooking reference is\n((",(0,i.jsx)("code",{children:"repair_ref"}),"))\nand your selected appointment date is\n((",(0,i.jsx)("code",{children:"appointment_time"}),"  from"]}),(0,i.jsx)("a",{href:"../repairs-api/endpoints/repair#body",children:(0,i.jsx)("code",{children:"time.display"})}),(0,i.jsx)(n.p,{children:"))."})]})]})]}),"\n",(0,i.jsx)(n.h4,{id:"internal-notification-email",children:"Internal notification email"}),"\n",(0,i.jsxs)(n.p,{children:["Email notification template ID is configured via ",(0,i.jsx)(n.a,{href:"#environment-variables",children:"environment variables"}),"."]}),"\n",(0,i.jsxs)(r,{children:[(0,i.jsx)("summary",{children:"Suggested email template"}),(0,i.jsxs)("div",{children:[(0,i.jsxs)(n.p,{children:[(0,i.jsx)("strong",{children:"From:"}),"\tHousing Repairs Online ",(0,i.jsx)("br",{}),"\n",(0,i.jsx)("strong",{children:"To:"}),"\t((",(0,i.jsx)("code",{children:"email"})," from ",(0,i.jsx)("a",{href:"#email-env",children:(0,i.jsx)("code",{children:"INTERNAL_EMAIL"})}),")) ",(0,i.jsx)("br",{}),"\n",(0,i.jsx)("strong",{children:"Subject:"}),"\tRepair details ((",(0,i.jsx)("code",{children:"repair_ref"})," generated when saving into Cosmos DB)) ",(0,i.jsx)("br",{})]}),(0,i.jsx)("hr",{}),(0,i.jsx)("p",{children:(0,i.jsxs)(n.p,{children:["A new online repair has been logged. Please add the repair to universal.",(0,i.jsx)("br",{}),"\nThe repair details are:",(0,i.jsx)("br",{}),"\nRepair reference: ((",(0,i.jsx)("code",{children:"repair_ref"}),"))",(0,i.jsx)("br",{}),"\nProperty Reference: ((",(0,i.jsx)("code",{children:"uprn"})," from ",(0,i.jsx)("a",{href:"../repairs-api/endpoints/repair#body",children:(0,i.jsx)("code",{children:"address.locationId"})}),"))",(0,i.jsx)("br",{}),"\nAddress: ((",(0,i.jsx)("code",{children:"uprn"})," from ",(0,i.jsx)("a",{href:"../repairs-api/endpoints/repair#body",children:(0,i.jsx)("code",{children:"address.display"})}),"))",(0,i.jsx)("br",{}),"\nSoR: ((",(0,i.jsx)("code",{children:"sor"})," generated when saving into Cosmos DB ))",(0,i.jsx)("br",{}),"\nDescription: ((",(0,i.jsx)("code",{children:"repair_desc"})," from ",(0,i.jsx)("a",{href:"../repairs-api/endpoints/repair#body",children:(0,i.jsx)("code",{children:"description.text"})}),"\n))",(0,i.jsx)("br",{}),"\nContact number: ((",(0,i.jsx)("code",{children:"contact_no"})," from ",(0,i.jsx)("a",{href:"../repairs-api/endpoints/repair#body",children:(0,i.jsx)("code",{children:"contactPersonNumber"})}),"\n))",(0,i.jsx)("br",{}),"\nPhotos uploaded: ((",(0,i.jsx)("code",{children:"image_1"}),"))",(0,i.jsx)("br",{})]})})]})]}),"\n",(0,i.jsx)(n.h2,{id:"environment-variables",children:"Environment variables"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Name"}),(0,i.jsx)(n.th,{children:"Description"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"AUTHENTICATION_IDENTIFIER"}),(0,i.jsx)(n.td,{children:"A unique identifier used to validate access.*"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"JWT_SECRET"}),(0,i.jsx)(n.td,{children:"A hash secret used for encryption.*"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"../housing-management-system-api/intro",children:"ADDRESSES_API_URL"})}),(0,i.jsx)(n.td,{children:"Address API URL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"../scheduling-api/intro",children:"SCHEDULING_API_URL"})}),(0,i.jsx)(n.td,{children:"Scheduling API URL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)("span",{id:"cosmos-env",children:"COSMOS_ENDPOINT_URL"})}),(0,i.jsx)(n.td,{children:"Cosmos endpoint URL"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"COSMOS_AUTHORIZATION_KEY"}),(0,i.jsx)(n.td,{children:"Cosmos authorization key"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"COSMOS_DATABASE_ID"}),(0,i.jsxs)(n.td,{children:["Cosmos database name, e.g.: ",(0,i.jsx)(n.code,{children:"housing-repairs-online"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"COSMOS_CONTAINER_ID"}),(0,i.jsxs)(n.td,{children:["Cosmos table name, e.g.: ",(0,i.jsx)(n.code,{children:"repairs-requests"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)("span",{id:"blob-env",children:"AZURE_STORAGE_CONNECTION_STRING"})}),(0,i.jsx)(n.td,{children:"Blob storage connection string"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"STORAGE_CONTAINER_NAME"}),(0,i.jsxs)(n.td,{children:["Blob storage container name, e.g.: ",(0,i.jsx)(n.code,{children:"housing-repairs-online"})]})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"GOV_NOTIFY_KEY"}),(0,i.jsx)(n.td,{children:"Gov notification key"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)("span",{id:"n-sms-env",children:"CONFIRMATION_SMS_NOTIFY_TEMPLATE_ID"})}),(0,i.jsx)(n.td,{children:"Id of the SMS template that will be sent to customers"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)("span",{id:"n-email-env",children:"CONFIRMATION_EMAIL_NOTIFY_TEMPLATE_ID"})}),(0,i.jsx)(n.td,{children:"Id of the email template that will be sent to customers"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)("span",{id:"i-email-env",children:"INTERNAL_EMAIL_NOTIFY_TEMPLATE_ID"})}),(0,i.jsx)(n.td,{children:"Id of the template that will be sent to staff"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)("span",{id:"email-env",children:"INTERNAL_EMAIL"})}),(0,i.jsx)(n.td,{children:"Email to which internal staff emails will be sent to"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"DAYS_UNTIL_IMAGE_EXPIRY"}),(0,i.jsx)(n.td,{children:"Number of days attached images can be accessible for"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"../alerting-and-monitoring/intro#azure-component-setup",children:"SENTRY_DSN"})}),(0,i.jsx)(n.td,{children:(0,i.jsx)(n.a,{href:"https://docs.sentry.io/product/sentry-basics/dsn-explainer/",children:"Sentry Data Source Name"})})]})]})]}),"\n",(0,i.jsxs)(n.p,{children:["* See ",(0,i.jsx)(n.a,{href:"../apis/authentication",children:"Authentication"})," for more details."]}),"\n",(0,i.jsx)(n.h2,{id:"health-checks",children:"Health Checks"}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"../apis/health-checks",children:"Health Checks"})," for details."]}),"\n",(0,i.jsx)(n.p,{children:"The API is determined to be health if:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Each Housing Repairs API it depends upon is healthy"}),"\n",(0,i.jsx)(n.li,{children:"It can connect to the configured Azure Cosmos DB"}),"\n",(0,i.jsx)(n.li,{children:"It can connect to the configured Azure Blob storage"}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>o,x:()=>d});var i=r(6540);const s={},t=i.createContext(s);function o(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);